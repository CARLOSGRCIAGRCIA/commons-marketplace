paths:
    /categories:
        get:
            tags: [Categories]
            summary: Get all categories
            description: Returns a list of all available categories with their hierarchy information. Includes both main categories and subcategories.
            parameters:
                - in: query
                  name: includeInactive
                  schema:
                      type: boolean
                      default: false
                  description: Include inactive categories in the results
                  example: false
                - in: query
                  name: level
                  schema:
                      type: integer
                      enum: [0, 1]
                  description: Filter by category level (0=main categories, 1=subcategories)
                  example: 0
            responses:
                '200':
                    description: A list of categories with hierarchy information.
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/CategoryResponse'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
        post:
            tags: [Categories]
            summary: Create a new category
            description: |
                Adds a new category or subcategory. Requires authentication and 'Admin' role.
                For subcategories, provide the parent category ID. Category names and slugs must be unique.
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CategoryInput'
            responses:
                '201':
                    description: Category created successfully.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CategoryResponse'
                '400':
                    description: Invalid input data or validation error.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                duplicateSlug:
                                    value:
                                        message: 'Category with this slug already exists'
                                invalidParent:
                                    value:
                                        message: 'Parent category not found or cannot create subcategory of another subcategory'
                '401':
                    description: Unauthorized - Missing or invalid token.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '403':
                    description: Forbidden - User does not have 'Admin' role.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

    /categories/main:
        get:
            tags: [Categories]
            summary: Get all main categories
            description: Returns a list of all main categories (categories without parent).
            parameters:
                - in: query
                  name: includeInactive
                  schema:
                      type: boolean
                      default: false
                  description: Include inactive categories in the results
                  example: false
            responses:
                '200':
                    description: A list of main categories.
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/CategoryResponse'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

    /categories/{parentId}/subcategories:
        parameters:
            - in: path
              name: parentId
              required: true
              schema:
                  type: string
              description: The ID of the parent category.
              example: '60c72b2f9b1d8e001f8e4c5d'
        get:
            tags: [Categories]
            summary: Get all subcategories of a category
            description: Returns a list of all subcategories belonging to a specific parent category.
            parameters:
                - in: query
                  name: includeInactive
                  schema:
                      type: boolean
                      default: false
                  description: Include inactive subcategories in the results
                  example: false
            responses:
                '200':
                    description: A list of subcategories.
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/CategoryResponse'
                '404':
                    description: Parent category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '500':
                    description: Internal server error.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

    /categories/hierarchy/{id}:
        parameters:
            - in: path
              name: id
              required: true
              schema:
                  type: string
              description: The ID of the category to get hierarchy for.
              example: '60c72b2f9b1d8e001f8e4c5e'
        get:
            tags: [Categories]
            summary: Get category hierarchy
            description: Retrieves the complete hierarchy path for a category, including all parent categories.
            responses:
                '200':
                    description: Category hierarchy found.
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/CategoryResponse'
                '404':
                    description: Category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '500':
                    description: Internal server error.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

    /categories/{id}:
        parameters:
            - in: path
              name: id
              required: true
              schema:
                  type: string
              description: The ID of the category.
              example: '60c72b2f9b1d8e001f8e4c5d'
        get:
            tags: [Categories]
            summary: Get a category by ID
            description: Retrieves the details of a single category including hierarchy information.
            responses:
                '200':
                    description: Category details found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CategoryResponse'
                '404':
                    description: Category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '500':
                    description: Internal server error.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
        put:
            tags: [Categories]
            summary: Update a category
            description: Updates an existing category. Requires authentication and 'Admin' role. Cannot change parent relationship for existing categories.
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CategoryUpdateInput'
            responses:
                '200':
                    description: Category updated successfully.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CategoryResponse'
                '400':
                    description: Invalid input data.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                duplicateSlug:
                                    value:
                                        message: 'Category with this slug already exists'
                '401':
                    description: Unauthorized - Missing or invalid token.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '403':
                    description: Forbidden - User does not have 'Admin' role.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '404':
                    description: Category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
        delete:
            tags: [Categories]
            summary: Delete a category
            description: Deletes a category. Requires authentication and 'Admin' role. Cannot delete categories with subcategories or products.
            security:
                - BearerAuth: []
            responses:
                '204':
                    description: Category deleted successfully. No content.
                '400':
                    description: Cannot delete category due to dependencies.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                hasSubcategories:
                                    value:
                                        message: 'Cannot delete category with subcategories'
                                hasProducts:
                                    value:
                                        message: 'Cannot delete category with associated products'
                '401':
                    description: Unauthorized - Missing or invalid token.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '403':
                    description: Forbidden - User does not have 'Admin' role.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '404':
                    description: Category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

    /categories/{id}/deactivate:
        parameters:
            - in: path
              name: id
              required: true
              schema:
                  type: string
              description: The ID of the category to deactivate.
              example: '60c72b2f9b1d8e001f8e4c5d'
        patch:
            tags: [Categories]
            summary: Deactivate a category
            description: Deactivates a category (soft delete). Requires authentication and 'Admin' role. Also deactivates all subcategories.
            security:
                - BearerAuth: []
            responses:
                '200':
                    description: Category deactivated successfully.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CategoryResponse'
                '401':
                    description: Unauthorized - Missing or invalid token.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '403':
                    description: Forbidden - User does not have 'Admin' role.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '404':
                    description: Category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

    /categories/{id}/activate:
        parameters:
            - in: path
              name: id
              required: true
              schema:
                  type: string
              description: The ID of the category to activate.
              example: '60c72b2f9b1d8e001f8e4c5d'
        patch:
            tags: [Categories]
            summary: Activate a category
            description: Activates a previously deactivated category. Requires authentication and 'Admin' role.
            security:
                - BearerAuth: []
            responses:
                '200':
                    description: Category activated successfully.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CategoryResponse'
                '401':
                    description: Unauthorized - Missing or invalid token.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '403':
                    description: Forbidden - User does not have 'Admin' role.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                '404':
                    description: Category not found.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'

components:
    schemas:
        CategoryResponse:
            type: object
            description: Represents a category in the system with hierarchy information.
            properties:
                id:
                    type: string
                    description: The category's unique identifier.
                    example: '60c72b2f9b1d8e001f8e4c5d'
                name:
                    type: string
                    example: 'Electronics'
                    description: The name of the category
                slug:
                    type: string
                    example: 'electronics'
                    description: URL-friendly version of the category name
                description:
                    type: string
                    example: 'Electronic devices and gadgets'
                    description: Description of the category
                parent:
                    type: string
                    nullable: true
                    description: The ID of the parent category (null for main categories)
                    example: null
                parentName:
                    type: string
                    nullable: true
                    description: The name of the parent category
                    example: null
                level:
                    type: integer
                    description: The hierarchy level (0 for main categories, 1 for subcategories)
                    example: 0
                    minimum: 0
                    maximum: 1
                isActive:
                    type: boolean
                    description: Whether the category is active
                    example: true
                productCount:
                    type: integer
                    description: Number of products in this category
                    example: 150
                    minimum: 0
                subCategoryCount:
                    type: integer
                    description: Number of subcategories under this category
                    example: 5
                    minimum: 0
                createdAt:
                    type: string
                    format: date-time
                    example: '2024-01-15T10:30:00Z'
                updatedAt:
                    type: string
                    format: date-time
                    example: '2024-01-15T14:45:00Z'
        CategoryInput:
            type: object
            description: Data required to create a new category or subcategory.
            required:
                - name
                - slug
            properties:
                name:
                    type: string
                    example: 'Electronics'
                    minLength: 2
                    maxLength: 50
                    description: Name of the category (must be unique)
                slug:
                    type: string
                    example: 'electronics'
                    minLength: 2
                    maxLength: 50
                    pattern: '^[a-z0-9]+(?:-[a-z0-9]+)*$'
                    description: URL-friendly slug (must be unique, lowercase, hyphens allowed)
                description:
                    type: string
                    example: 'Electronic devices and gadgets'
                    minLength: 5
                    maxLength: 500
                    description: Description of the category
                parent:
                    type: string
                    description: The ID of the parent category (for creating subcategories)
                    example: '60c72b2f9b1d8e001f8e4c5d'
        CategoryUpdateInput:
            type: object
            description: Data for updating an existing category. Parent cannot be changed for existing categories.
            properties:
                name:
                    type: string
                    example: 'Updated Electronics'
                    minLength: 2
                    maxLength: 50
                    description: New name for the category
                slug:
                    type: string
                    example: 'updated-electronics'
                    minLength: 2
                    maxLength: 50
                    pattern: '^[a-z0-9]+(?:-[a-z0-9]+)*$'
                    description: New slug for the category
                description:
                    type: string
                    example: 'Updated description for electronics category'
                    minLength: 5
                    maxLength: 500
                    description: New description for the category
                isActive:
                    type: boolean
                    example: true
                    description: Whether the category is active
        CategoryHierarchyResponse:
            type: object
            description: Represents a category with its complete hierarchy
            properties:
                category:
                    $ref: '#/components/schemas/CategoryResponse'
                hierarchy:
                    type: array
                    items:
                        $ref: '#/components/schemas/CategoryResponse'
                    description: Complete hierarchy path from root to current category
                subcategories:
                    type: array
                    items:
                        $ref: '#/components/schemas/CategoryResponse'
                    description: Direct subcategories of this category
        ErrorResponse:
            type: object
            required:
                - message
            properties:
                message:
                    type: string
                    example: 'Category not found'
                errors:
                    type: array
                    items:
                        type: object
                        properties:
                            field:
                                type: string
                                example: 'name'
                            message:
                                type: string
                                example: 'Name must be at least 2 characters long'
                            value:
                                type: string
                                example: 'E'
                code:
                    type: string
                    example: 'CATEGORY_NOT_FOUND'
                    enum:
                        [
                            CATEGORY_NOT_FOUND,
                            DUPLICATE_SLUG,
                            INVALID_PARENT,
                            HAS_DEPENDENCIES,
                            VALIDATION_ERROR,
                        ]

    securitySchemes:
        BearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT
            description: JWT token from Supabase Auth
